{% extends "base.html" %}
{% load humanize %}

{% block title %}
  {{block.super}} | {{object}}
{% endblock title %}

{% block content %}

  <h2>{{ object }}{% if officer_id %}: officer {{officer_id}} {% endif %}</h2>

  <!-- stop data -->
  <div class="row">
    <h2>Stops data</h2>

    <div class="col-md-4">
      <h3>Fraction of stops by race</h3>

      <div>
        <svg id="stop_race_pie"></svg>
      </div>

      <p class="help-block">
        Pie chart showing the annual average stop-ratio by
        race, in pie-chart format.
      </p>
    </div>

    <div id="stop_div" class="col-md-8">
      <h3>Annual percent of stops by race</h3>

      <div>
        <svg id="stop_race_line"></svg>
      </div>

      <p class="help-block">
        These lines will add up to 100%. Note that this shows by race and not
        by ethnicity; a feature will be added to show by ethnicity globally for
        all plots. Another feature we plan to add will allow a data-table to
        be created, to present the underlying data behind the plots.
      </p>
    </div>
  </div>
  <hr>

  <!-- search data -->
  <div class="row">
    <h2>Search data</h2>

    <div class="col-md-4">
      <h3>Fraction of search by race</h3>

      <div>
        <svg id="search_race_pie"></svg>
      </div>

      <p class="help-block">
        Pie chart showing the annual average search-ratio by
        race, in pie-chart format.
      </p>
    </div>

    <div id="search_div" class="col-md-8">
      <h3>Annual percent of search by race</h3>

      <div>
        <svg id="search_race_line"></svg>
      </div>

      <p class="help-block">
        These lines will add up to 100%. Note that this shows by race and not
        by ethnicity; a feature will be added to show by ethnicity globally for
        all plots. Another feature we plan to add will allow a data-table to
        be created, to present the underlying data behind the plots.
      </p>
    </div>
  </div>

  <div class="row">
    <div id="lhs_div" class="col-md-offset-2 col-md-8">
      <h3>Likelihood of search by stop-cause</h3>

      <div>
        <svg id="lsb"></svg>
      </div>

      <p class="help-block">
        Likelihood of search by various stop-causes.
      </p>
    </div>
  </div>
  <hr>

  <div class="row">
    <div id="contraband_div" class="col-md-offset-2 col-md-8">
      <h3>Contraband hit-rate</h3>

      <div>
        <svg id="chr"></svg>
      </div>

      <p class="help-block">
        Bar chart of percent of total searches where ANY contraband was found is reported, stratified by race/ethnicity.
      </p>
    </div>
  </div>
  <hr>

  <!-- use-of-force data -->
  <div class="row">
    <h2>Use-of-force data</h2>

    <div class="col-md-4">
      <h3>Fraction of use-of-force by race</h3>

      <div>
        <svg id="use_force_race_pie"></svg>
      </div>

      <p class="help-block">
        Pie chart showing the annual average use-of-force-ratio by
        race, in pie-chart format.
      </p>
    </div>

    <div id="use_force_div" class="col-md-8">
      <h3>Annual percent of use-of-force by race</h3>

      <div>
        <svg id="use_force_race_line"></svg>
      </div>

      <p class="help-block">
        These lines will add up to 100%. Note that this shows by race and not
        by ethnicity; a feature will be added to show by ethnicity globally for
        all plots. Another feature we plan to add will allow a data-table to
        be created, to present the underlying data behind the plots.
      </p>
    </div>
  </div>

  {% if not officer_id %}
    <!-- officer pages -->
    <div class="row">
      <h3>Officers ({{ officers.count|intcomma }} total)</h3>
      <ul>
        {% for officer in officers %}
        <li><a href="{% url 'agency-detail' object.pk %}?officer_id={{ officer.officer_id|urlencode }}">{{ officer.officer_id }} ({{ officer.total_stops|intcomma }})</a></li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
{% endblock %}


{% block extra-js %}
  <script type="text/javascript">
    $(document).ready(function(){
      {% if officer_id %}
        // Retrieve data from API using data-handlers
        var stop_handler = new StopsHandler({url: "{% url 'agency-api-stops' object.pk %}?officer={{officer_id|urlencode}}"}),
            search_handler = new SearchHandler({url: "{% url 'agency-api-searches' object.pk %}?officer={{officer_id|urlencode}}"}),
            uf_handler = new UseOfForceHandler({url: "{% url 'agency-api-use-of-force' object.pk %}?officer={{officer_id|urlencode}}"}),
            lhs_handler = new LikelihoodSearchHandler({url: "{% url 'agency-api-stops-by-reason' object.pk %}?officer={{officer_id|urlencode}}"}),
            chr_handler = new ContrabandHitRateHandler({url: "{% url 'agency-api-contraband-hit-rate' object.pk %}?officer={{officer_id|urlencode}}"});
      {% else %}
        // Retrieve data from API using data-handlers
        var stop_handler = new StopsHandler({url: "{% url 'agency-api-stops' object.pk %}"}),
            search_handler = new SearchHandler({url: "{% url 'agency-api-searches' object.pk %}"}),
            uf_handler = new UseOfForceHandler({url: "{% url 'agency-api-use-of-force' object.pk %}"}),
            lhs_handler = new LikelihoodSearchHandler({url: "{% url 'agency-api-stops-by-reason' object.pk %}"}),
            chr_handler = new ContrabandHitRateHandler({url: "{% url 'agency-api-contraband-hit-rate' object.pk %}"});
      {% endif %}

      // Create plots for each data-type
      new StopRatioDonut({handler: stop_handler, selector: "#stop_race_pie"}),
      new StopRatioTimeSeries({handler: stop_handler, selector: "#stop_race_line"});

      new SearchRatioDonut({handler: search_handler, selector: "#search_race_pie"}),
      new SearchRatioTimeSeries({handler: search_handler, selector: "#search_race_line"});

      new UseOfForceDonut({handler: uf_handler, selector: "#use_force_race_pie"}),
      new UseOfForceTimeSeries({handler: uf_handler, selector: "#use_force_race_line"});

      new LikelihoodOfSearch({handler: lhs_handler, selector: "#lsb"});
      new ContrabandHitRateBar({handler: chr_handler, selector: "#chr"});

      // create tables
      new StopsTable({handler: stop_handler, selector: "#stop_div"});
      new SearchTable({handler: search_handler, selector: "#search_div"});
      new UseOfForceTable({handler: uf_handler, selector: "#use_force_div"});
      new LikelihoodSearchTable({handler: lhs_handler, selector: "#lhs_div"});
      new ContrabandTable({handler: chr_handler, selector: "#contraband_div"});
    });
  </script>
{% endblock extra-js %}
