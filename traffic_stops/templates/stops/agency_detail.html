{% extends "base.html" %}
{% load humanize %}

{% block title %}
  {{block.super}} | {{object}}
{% endblock title %}

{% block content %}

  <h2>{{ object }}{% if officer_id %}: officer {{officer_id}} {% endif %}</h2>

  <!-- census data -->
  <div id="census_row" class="row">
    <h2>2010 census data</h2>

    <div class="col-md-4">
      <h3>Percentage by race</h3>
      <svg id="census_pie"></svg>
    </div>

    <div class="col-md-8">
      <h3>Data table</h3>
      <br><br>
      <div id="census_data"></div>
    </div>

  </div>
  <hr>


  <!-- stop data -->
  <div class="row">
    <h2>Stops data</h2>

    <div class="col-md-4">
      <h3>Fraction of stops by race</h3>

      <div>
        <svg id="stop_race_pie"></svg>
      </div>

      <p class="help-block">
        Pie chart showing the annual average stop-ratio by
        race, in pie-chart format.
      </p>
    </div>

    <div id="stop_div" class="col-md-8">
      <h3>Annual percent of stops by race</h3>

      <div role="tabpanel">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active">
            <a href="#stop_race_line_div" aria-controls="stop_race_line_div" role="tab" data-toggle="tab">Chart</a></li>
          <li role="presentation">
            <a href="#stop_race_data" aria-controls="stop_race_data" role="tab" data-toggle="tab">Data</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="stop_race_line_div">
            <svg id="stop_race_line"></svg>
              <p class="help-block">
                  LINE CHART TEXT
              </p>
          </div>
          <div role="tabpanel" class="tab-pane" id="stop_race_data">
            <p class="help-block">
              DATA TABLE TEXT
            </p>
          </div>
        </div>

      </div>

    </div>
  </div>
  <hr>

  <!-- search data -->
  <div class="row">
    <h2>Search data</h2>

    <div class="col-md-4">
      <h3>Fraction of search by race</h3>

      <div>
        <svg id="search_race_pie"></svg>
      </div>

      <p class="help-block">
        Pie chart showing the annual average search-ratio by
        race, in pie-chart format.
      </p>
    </div>

    <div id="search_div" class="col-md-8">
      <h3>Annual percent of search by race</h3>

      <div role="tabpanel">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active">
            <a href="#search_race_line_div" aria-controls="search_race_line_div" role="tab" data-toggle="tab">Chart</a></li>
          <li role="presentation">
            <a href="#search_race_data" aria-controls="stop_race_data" role="tab" data-toggle="tab">Data</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="search_race_line_div">
            <svg id="search_race_line"></svg>
              <p class="help-block">
                  LINE CHART TEXT
              </p>
          </div>
          <div role="tabpanel" class="tab-pane" id="search_race_data">
            <p class="help-block">
              DATA TABLE TEXT
            </p>
          </div>
        </div>

      </div>

    </div>
  </div>

  <div class="row">
    <div id="lhs_div" class="col-md-offset-2 col-md-8">
      <h3>Likelihood of search by stop-cause</h3>

      <div role="tabpanel">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active">
            <a href="#lsb_div" aria-controls="lsb_div" role="tab" data-toggle="tab">Chart</a></li>
          <li role="presentation">
            <a href="#lsb_data" aria-controls="lsb_data" role="tab" data-toggle="tab">Data</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="lsb_div">
            <svg id="lsb"></svg>
              <p class="help-block">
                  LINE CHART TEXT
              </p>
          </div>
          <div role="tabpanel" class="tab-pane" id="lsb_data">
            <p class="help-block">
              DATA TABLE TEXT
            </p>
          </div>
        </div>

      </div>

    </div>
  </div>
  <hr>

  <div class="row">
    <div id="contraband_div" class="col-md-offset-2 col-md-8">
      <h3>Contraband hit-rate</h3>

      <div role="tabpanel">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active">
            <a href="#chr_div" aria-controls="chr_div" role="tab" data-toggle="tab">Chart</a></li>
          <li role="presentation">
            <a href="#chr_data" aria-controls="chr_data" role="tab" data-toggle="tab">Data</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="chr_div">
            <svg id="chr"></svg>
              <p class="help-block">
                  LINE CHART TEXT
              </p>
          </div>
          <div role="tabpanel" class="tab-pane" id="chr_data">
            <p class="help-block">
              DATA TABLE TEXT
            </p>
          </div>
        </div>

      </div>

    </div>
  </div>
  <hr>

  <!-- use-of-force data -->
  <div class="row">
    <h2>Use-of-force data</h2>

    <div class="col-md-4">
      <h3>Fraction of use-of-force by race</h3>

      <div>
        <svg id="use_force_race_pie"></svg>
      </div>

      <p class="help-block">
        Pie chart showing the annual average use-of-force-ratio by
        race, in pie-chart format.
      </p>
    </div>

    <div id="use_force_div" class="col-md-8">
      <h3>Annual percent of use-of-force by race</h3>

      <div role="tabpanel">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active">
            <a href="#use_force_race_line_div" aria-controls="use_force_race_line_div" role="tab" data-toggle="tab">Chart</a></li>
          <li role="presentation">
            <a href="#use_force_race__data" aria-controls="use_force_race__data" role="tab" data-toggle="tab">Data</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="use_force_race_line_div">
            <svg id="use_force_race_line"></svg>
              <p class="help-block">
                  LINE CHART TEXT
              </p>
          </div>
          <div role="tabpanel" class="tab-pane" id="use_force_race__data">
            <p class="help-block">
              DATA TABLE TEXT
            </p>
          </div>
        </div>

      </div>

    </div>
  </div>

{% endblock %}


{% block extra-js %}
  <script type="text/javascript">
    $(document).ready(function(){
      {% if officer_id %}
        // Retrieve data from API using data-handlers
        var stop_handler = new StopsHandler({url: "{% url 'agency-api-stops' object.pk %}?officer={{officer_id|urlencode}}"}),
            search_handler = new SearchHandler({url: "{% url 'agency-api-searches' object.pk %}?officer={{officer_id|urlencode}}"}),
            uf_handler = new UseOfForceHandler({url: "{% url 'agency-api-use-of-force' object.pk %}?officer={{officer_id|urlencode}}"}),
            lhs_handler = new LikelihoodSearchHandler({url: "{% url 'agency-api-stops-by-reason' object.pk %}?officer={{officer_id|urlencode}}"}),
            chr_handler = new ContrabandHitRateHandler({url: "{% url 'agency-api-contraband-hit-rate' object.pk %}?officer={{officer_id|urlencode}}"});
      {% else %}
        // Retrieve data from API using data-handlers
        var census_handler = new CensusHandler({url: "{{ STATIC_URL }}js/census.temporary.json", agency:{{object.pk}}}),
            stop_handler = new StopsHandler({url: "{% url 'agency-api-stops' object.pk %}"}),
            search_handler = new SearchHandler({url: "{% url 'agency-api-searches' object.pk %}"}),
            uf_handler = new UseOfForceHandler({url: "{% url 'agency-api-use-of-force' object.pk %}"}),
            lhs_handler = new LikelihoodSearchHandler({url: "{% url 'agency-api-stops-by-reason' object.pk %}"}),
            chr_handler = new ContrabandHitRateHandler({url: "{% url 'agency-api-contraband-hit-rate' object.pk %}"});
      {% endif %}

      new CensusRatioDonut({handler: census_handler, selector: "#census_pie"});
      new CensusTable({handler: census_handler, selector: "#census_data"});

      new StopRatioDonut({handler: stop_handler, selector: "#stop_race_pie"});
      new StopRatioTimeSeries({handler: stop_handler, selector: "#stop_race_line"});
      new StopsTable({handler: stop_handler, selector: "#stop_race_data"});

      new SearchRatioDonut({handler: search_handler, selector: "#search_race_pie"});
      new SearchRatioTimeSeries({handler: search_handler, selector: "#search_race_line"});
      new SearchTable({handler: search_handler, selector: "#search_race_data"});

      new LikelihoodOfSearch({handler: lhs_handler, selector: "#lsb"});
      new LikelihoodSearchTable({handler: lhs_handler, selector: "#lsb_data"});

      new ContrabandHitRateBar({handler: chr_handler, selector: "#chr"});
      new ContrabandTable({handler: chr_handler, selector: "#chr_data"});

      new UseOfForceDonut({handler: uf_handler, selector: "#use_force_race_pie"});
      new UseOfForceTimeSeries({handler: uf_handler, selector: "#use_force_race_line"});
      new UseOfForceTable({handler: uf_handler, selector: "#use_force_race__data"});

    });
  </script>
{% endblock extra-js %}
